<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 The One-to-Many Relationship | DataManagement.knit</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 The One-to-Many Relationship | DataManagement.knit" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 The One-to-Many Relationship | DataManagement.knit" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-single-entity.html"/>
<link rel="next" href="the-many-to-many-relationship.html"/>
<script src="libs/header-attrs-2.12/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="data-management-databases-and-organizations.html#data-management-databases-and-organizations">Data Management: Databases and Organizations<span></span></a></li>
<li><a href="preface.html#preface">Preface<span></span></a>
<ul>
<li><a href="preface.html#supplements">Supplements<span></span></a></li>
<li><a href="preface.html#acknowledgments">Acknowledgments<span></span></a></li>
</ul></li>
<li><a href="section-1-the-managerial-perspective.html#section-1-the-managerial-perspective">Section 1 The Managerial Perspective<span></span></a></li>
<li class="chapter" data-level="1" data-path="managing-data.html"><a href="managing-data.html"><i class="fa fa-check"></i><b>1</b> Managing Data<span></span></a>
<ul>
<li><a href="managing-data.html#introduction">Introduction<span></span></a></li>
<li><a href="managing-data.html#individual-data-management">Individual data management<span></span></a></li>
<li><a href="managing-data.html#organizational-data-management">Organizational data management<span></span></a></li>
<li><a href="managing-data.html#problems-with-data-management-systems">Problems with data management systems<span></span></a></li>
<li><a href="managing-data.html#a-brief-history-of-data-management-systems">A brief history of data management systems<span></span></a></li>
<li><a href="managing-data.html#data-information-and-knowledge">Data, information, and knowledge<span></span></a></li>
<li><a href="managing-data.html#the-challenge">The challenge<span></span></a></li>
<li><a href="managing-data.html#exercises">Exercises<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="information.html"><a href="information.html"><i class="fa fa-check"></i><b>2</b> Information<span></span></a>
<ul>
<li><a href="information.html#introduction-1">Introduction<span></span></a></li>
<li><a href="information.html#a-historical-perspective">A historical perspective<span></span></a></li>
<li><a href="information.html#a-brief-history-of-information-systems">A brief history of information systems<span></span></a></li>
<li><a href="information.html#information-characteristics">Information characteristics<span></span></a></li>
<li><a href="information.html#information-and-organizational-change">Information and organizational change<span></span></a></li>
<li><a href="information.html#information-and-managerial-work">Information and managerial work<span></span></a></li>
<li><a href="information.html#managers-information-requirements">Managers’ information requirements<span></span></a></li>
<li><a href="information.html#information-delivery-systems">Information delivery systems<span></span></a></li>
<li><a href="information.html#information-integration">Information integration<span></span></a></li>
<li><a href="information.html#knowledge-1">Knowledge<span></span></a></li>
<li><a href="information.html#exercises-1">Exercises<span></span></a></li>
</ul></li>
<li><a href="section-2-data-modeling-and-sql.html#section-2-data-modeling-and-sql">Section 2 Data Modeling and SQL<span></span></a></li>
<li class="chapter" data-level="3" data-path="the-single-entity.html"><a href="the-single-entity.html"><i class="fa fa-check"></i><b>3</b> The Single Entity<span></span></a>
<ul>
<li><a href="the-single-entity.html#the-relational-model">The relational model<span></span></a></li>
<li><a href="the-single-entity.html#getting-started">Getting started<span></span></a></li>
<li><a href="the-single-entity.html#modeling-a-single-entity-database">Modeling a single-entity database<span></span></a></li>
<li><a href="the-single-entity.html#creating-a-single-table-database">Creating a single-table database<span></span></a></li>
<li><a href="the-single-entity.html#querying-a-single-table-database">Querying a single-table database<span></span></a></li>
<li><a href="the-single-entity.html#exercises-2">Exercises<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html"><i class="fa fa-check"></i><b>4</b> The One-to-Many Relationship<span></span></a>
<ul>
<li><a href="the-one-to-many-relationship.html#relationships">Relationships<span></span></a></li>
<li><a href="the-one-to-many-relationship.html#creating-a-database-with-a-1m-relationship">Creating a database with a 1:m relationship<span></span></a></li>
<li><a href="the-one-to-many-relationship.html#querying-a-two-table-database">Querying a two-table database<span></span></a></li>
<li><a href="the-one-to-many-relationship.html#regular-expressionpattern-matching-1">Regular expression—pattern matching<span></span></a></li>
<li><a href="the-one-to-many-relationship.html#subqueries-1">Subqueries<span></span></a></li>
<li><a href="the-one-to-many-relationship.html#exercises-3">Exercises<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html"><i class="fa fa-check"></i><b>5</b> The Many-to-Many Relationship<span></span></a>
<ul>
<li><a href="the-many-to-many-relationship.html#the-many-to-many-relationship-1">The many-to-many relationship<span></span></a></li>
<li><a href="the-many-to-many-relationship.html#creating-a-relational-database-with-an-mm-relationship">Creating a relational database with an m:m relationship<span></span></a></li>
<li><a href="the-many-to-many-relationship.html#querying-an-mm-relationship">Querying an m:m relationship<span></span></a></li>
<li><a href="the-many-to-many-relationship.html#key-terms-and-concepts-2">Key terms and concepts<span></span></a></li>
<li><a href="the-many-to-many-relationship.html#exercises-4">Exercises<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="one-to-one-and-recursive-relationships.html"><a href="one-to-one-and-recursive-relationships.html"><i class="fa fa-check"></i><b>6</b> One-to-One and Recursive Relationships<span></span></a>
<ul>
<li><a href="one-to-one-and-recursive-relationships.html#modeling-a-one-to-one-relationship">Modeling a one-to-one relationship<span></span></a></li>
<li><a href="one-to-one-and-recursive-relationships.html#mapping-a-one-to-one-relationship">Mapping a one-to-one relationship<span></span></a></li>
<li><a href="one-to-one-and-recursive-relationships.html#mapping-a-recursive-one-to-many-relationship">Mapping a recursive one-to-many relationship<span></span></a></li>
<li><a href="one-to-one-and-recursive-relationships.html#querying-a-one-to-one-relationship">Querying a one-to-one relationship<span></span></a></li>
<li><a href="one-to-one-and-recursive-relationships.html#querying-a-recursive-1m-relationship">Querying a recursive 1:m relationship<span></span></a></li>
<li><a href="one-to-one-and-recursive-relationships.html#modeling-a-recursive-one-to-one-relationship">Modeling a recursive one-to-one relationship<span></span></a></li>
<li><a href="one-to-one-and-recursive-relationships.html#mapping-a-recursive-one-to-one-relationship">Mapping a recursive one-to-one relationship<span></span></a></li>
<li><a href="one-to-one-and-recursive-relationships.html#querying-a-recursive-one-to-one-relationship">Querying a recursive one-to-one relationship<span></span></a></li>
<li><a href="one-to-one-and-recursive-relationships.html#modeling-a-recursive-many-to-many-relationship">Modeling a recursive many-to-many relationship<span></span></a></li>
<li><a href="one-to-one-and-recursive-relationships.html#mapping-a-recursive-many-to-many-relationship">Mapping a recursive many-to-many relationship<span></span></a></li>
<li><a href="one-to-one-and-recursive-relationships.html#querying-a-recursive-many-to-many-relationship">Querying a recursive many-to-many relationship<span></span></a></li>
<li><a href="one-to-one-and-recursive-relationships.html#exercises-5">Exercises<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-modeling.html"><a href="data-modeling.html"><i class="fa fa-check"></i><b>7</b> Data Modeling<span></span></a>
<ul>
<li><a href="data-modeling.html#modeling">Modeling<span></span></a></li>
<li><a href="data-modeling.html#data-modeling-1">Data modeling<span></span></a></li>
<li><a href="data-modeling.html#data-model-quality">Data model quality<span></span></a></li>
<li><a href="data-modeling.html#quality-improvement">Quality improvement<span></span></a></li>
<li><a href="data-modeling.html#data-modeling-hints">Data modeling hints<span></span></a></li>
<li><a href="data-modeling.html#the-seven-habits-of-highly-effective-data-modelers">The seven habits of highly effective data modelers<span></span></a></li>
<li><a href="data-modeling.html#exercises-6">Exercises<span></span></a></li>
</ul></li>
<li><a href="reference-1-basic-structures.html#reference-1-basic-structures">Reference 1: Basic Structures<span></span></a>
<ul>
<li><a href="reference-1-basic-structures.html#one-entity">One entity<span></span></a></li>
<li><a href="reference-1-basic-structures.html#two-entities">Two entities<span></span></a></li>
<li><a href="reference-1-basic-structures.html#another-entitys-identifier-as-part-of-the-identifier">Another entity’s identifier as part of the identifier<span></span></a></li>
<li><a href="reference-1-basic-structures.html#exercises-7">Exercises<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="normalization-and-other-data-modeling-methods.html"><a href="normalization-and-other-data-modeling-methods.html"><i class="fa fa-check"></i><b>8</b> Normalization and Other Data Modeling Methods<span></span></a>
<ul>
<li><a href="normalization-and-other-data-modeling-methods.html#multiple-paths">Multiple paths<span></span></a></li>
<li><a href="normalization-and-other-data-modeling-methods.html#normalization">Normalization<span></span></a></li>
<li><a href="normalization-and-other-data-modeling-methods.html#other-data-modeling-methods">Other data modeling methods<span></span></a></li>
<li><a href="normalization-and-other-data-modeling-methods.html#key-terms-and-concepts-5">Key terms and concepts<span></span></a></li>
<li><a href="normalization-and-other-data-modeling-methods.html#exercises-8">Exercises<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="the-relational-model-and-relational-algebra.html"><a href="the-relational-model-and-relational-algebra.html"><i class="fa fa-check"></i><b>9</b> The Relational Model and Relational Algebra<span></span></a>
<ul>
<li><a href="the-relational-model-and-relational-algebra.html#background">Background<span></span></a></li>
<li><a href="the-relational-model-and-relational-algebra.html#data-structures">Data structures<span></span></a></li>
<li><a href="the-relational-model-and-relational-algebra.html#integrity-rules">Integrity rules<span></span></a></li>
<li><a href="the-relational-model-and-relational-algebra.html#manipulation-languages">Manipulation languages<span></span></a></li>
<li><a href="the-relational-model-and-relational-algebra.html#a-fully-relational-database">A fully relational database<span></span></a></li>
<li><a href="the-relational-model-and-relational-algebra.html#exercises-9">Exercises<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="sql.html"><a href="sql.html"><i class="fa fa-check"></i><b>10</b> SQL<span></span></a>
<ul>
<li><a href="sql.html#structured-query-language">Structured query language<span></span></a></li>
<li><a href="sql.html#creating-a-table">Creating a table<span></span></a></li>
<li><a href="sql.html#data-types">Data types<span></span></a></li>
<li><a href="sql.html#collation-sequence">Collation sequence<span></span></a></li>
<li><a href="sql.html#scalar-functions">Scalar functions<span></span></a></li>
<li><a href="sql.html#formatting">Formatting<span></span></a></li>
<li><a href="sql.html#table-commands">Table commands<span></span></a></li>
<li><a href="sql.html#data-manipulation">Data manipulation<span></span></a></li>
<li><a href="sql.html#insert">INSERT<span></span></a></li>
<li><a href="sql.html#update-1">UPDATE<span></span></a></li>
<li><a href="sql.html#delete-1">DELETE<span></span></a></li>
<li><a href="sql.html#sql-routines">SQL routines<span></span></a></li>
<li><a href="sql.html#universal-unique-identifier-uuid">Universal Unique Identifier (UUID)<span></span></a></li>
<li><a href="sql.html#nullsmuch-ado-about-missing-information">Nulls—much ado about missing information<span></span></a></li>
<li><a href="sql.html#security">Security<span></span></a></li>
<li><a href="sql.html#the-system-catalog">The system catalog<span></span></a></li>
<li><a href="sql.html#natural-language-processing">Natural language processing<span></span></a></li>
<li><a href="sql.html#connectivity-and-odbc">Connectivity and ODBC<span></span></a></li>
<li><a href="sql.html#embedded-sql">Embedded SQL<span></span></a></li>
<li><a href="sql.html#user-defined-types">User-defined types<span></span></a></li>
<li><a href="sql.html#the-future-of-sql">The future of SQL<span></span></a></li>
</ul></li>
<li><a href="reference-2-sql-playbook.html#reference-2-sql-playbook">Reference 2: SQL Playbook<span></span></a>
<ul>
<li><a href="reference-2-sql-playbook.html#the-power-of-sql">The power of SQL<span></span></a></li>
</ul></li>
<li><a href="section-3-advanced-data-management.html#section-3-advanced-data-management">Section 3 Advanced Data Management<span></span></a></li>
<li class="chapter" data-level="11" data-path="spatial-and-temporal-data-management.html"><a href="spatial-and-temporal-data-management.html"><i class="fa fa-check"></i><b>11</b> Spatial and Temporal Data Management<span></span></a>
<ul>
<li><a href="spatial-and-temporal-data-management.html#spatial-data">Spatial data<span></span></a></li>
<li><a href="spatial-and-temporal-data-management.html#managing-spatial-data">Managing spatial data<span></span></a></li>
<li><a href="spatial-and-temporal-data-management.html#data-model-mapping">Data model mapping<span></span></a></li>
<li><a href="spatial-and-temporal-data-management.html#r-tree">R-tree<span></span></a></li>
<li><a href="spatial-and-temporal-data-management.html#managing-temporal-data">Managing temporal data<span></span></a></li>
<li><a href="spatial-and-temporal-data-management.html#key-terms-and-concepts-8">Key terms and concepts<span></span></a></li>
<li><a href="spatial-and-temporal-data-management.html#exercises-11">Exercises<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="graph-databases.html"><a href="graph-databases.html"><i class="fa fa-check"></i><b>12</b> Graph Databases<span></span></a>
<ul>
<li><a href="graph-databases.html#a-graph-database">A graph database<span></span></a></li>
<li><a href="graph-databases.html#neo4j-a-graph-database-implementation">Neo4j – a graph database implementation<span></span></a></li>
<li><a href="graph-databases.html#a-relationship-between-nodes">A relationship between nodes<span></span></a></li>
<li><a href="graph-databases.html#key-terms-and-concepts-9">Key terms and concepts<span></span></a></li>
<li><a href="graph-databases.html#exercises-12">Exercises<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="xml-managing-data-exchange.html"><a href="xml-managing-data-exchange.html"><i class="fa fa-check"></i><b>13</b> XML: Managing Data Exchange<span></span></a>
<ul>
<li><a href="xml-managing-data-exchange.html#four-problems">Four problems<span></span></a></li>
<li><a href="xml-managing-data-exchange.html#sgml">SGML<span></span></a></li>
<li><a href="xml-managing-data-exchange.html#xml">XML<span></span></a></li>
<li><a href="xml-managing-data-exchange.html#xml-schema">XML schema<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="organizational-intelligence.html"><a href="organizational-intelligence.html"><i class="fa fa-check"></i><b>14</b> Organizational Intelligence<span></span></a>
<ul>
<li><a href="organizational-intelligence.html#information-poverty">Information poverty<span></span></a></li>
<li><a href="organizational-intelligence.html#an-organizational-intelligence-system">An organizational intelligence system<span></span></a></li>
<li><a href="organizational-intelligence.html#the-data-warehouse">The data warehouse<span></span></a></li>
<li><a href="organizational-intelligence.html#exploiting-data-stores">Exploiting data stores<span></span></a></li>
<li><a href="organizational-intelligence.html#data-mining">Data mining<span></span></a></li>
<li><a href="organizational-intelligence.html#exercises-14">Exercises<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>15</b> Introduction to R<span></span></a>
<ul>
<li><a href="introduction-to-r.html#the-r-project">The R project<span></span></a></li>
<li><a href="introduction-to-r.html#datasets">Datasets<span></span></a></li>
<li><a href="introduction-to-r.html#packages">Packages<span></span></a></li>
<li><a href="introduction-to-r.html#file-handing">File handing<span></span></a></li>
<li><a href="introduction-to-r.html#data-manipulation-with-dplyr">Data manipulation with dplyr<span></span></a></li>
<li><a href="introduction-to-r.html#database-access">Database access<span></span></a></li>
<li><a href="introduction-to-r.html#excel-files">Excel files<span></span></a></li>
<li><a href="introduction-to-r.html#r-resources">R resources<span></span></a></li>
<li><a href="introduction-to-r.html#r-and-data-analytics">R and data analytics<span></span></a></li>
<li><a href="introduction-to-r.html#exercises-15">Exercises<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="data-visualization-1.html"><a href="data-visualization-1.html"><i class="fa fa-check"></i><b>16</b> Data visualization<span></span></a>
<ul>
<li><a href="data-visualization-1.html#visual-processing">Visual processing<span></span></a></li>
<li><a href="data-visualization-1.html#the-grammar-of-graphics">The grammar of graphics<span></span></a></li>
<li><a href="data-visualization-1.html#ggplot2">ggplot2<span></span></a></li>
<li><a href="data-visualization-1.html#some-recipes">Some recipes<span></span></a></li>
<li><a href="data-visualization-1.html#geographic-data">Geographic data<span></span></a></li>
<li><a href="data-visualization-1.html#r-resources-1">R resources<span></span></a></li>
<li><a href="data-visualization-1.html#exercises-16">Exercises<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="text-mining-natural-language-processing.html"><a href="text-mining-natural-language-processing.html"><i class="fa fa-check"></i><b>17</b> Text mining &amp; natural language processing<span></span></a>
<ul>
<li><a href="text-mining-natural-language-processing.html#the-nature-of-language">The nature of language<span></span></a></li>
<li><a href="text-mining-natural-language-processing.html#levels-of-processing">Levels of processing<span></span></a></li>
<li><a href="text-mining-natural-language-processing.html#tokenization">Tokenization<span></span></a></li>
<li><a href="text-mining-natural-language-processing.html#sentiment-analysis">Sentiment analysis<span></span></a></li>
<li><a href="text-mining-natural-language-processing.html#corpus">Corpus<span></span></a></li>
<li><a href="text-mining-natural-language-processing.html#readability">Readability<span></span></a></li>
<li><a href="text-mining-natural-language-processing.html#preprocessing">Preprocessing<span></span></a></li>
<li><a href="text-mining-natural-language-processing.html#word-frequency-analysis">Word frequency analysis<span></span></a></li>
<li><a href="text-mining-natural-language-processing.html#co-occurrence-and-association">Co-occurrence and association<span></span></a></li>
<li><a href="text-mining-natural-language-processing.html#cluster-analysis">Cluster analysis<span></span></a></li>
<li><a href="text-mining-natural-language-processing.html#topic-modeling">Topic modeling<span></span></a></li>
<li><a href="text-mining-natural-language-processing.html#named-entity-recognition-ner">Named-entity recognition (NER)<span></span></a></li>
<li><a href="text-mining-natural-language-processing.html#future-developments">Future developments<span></span></a></li>
<li><a href="text-mining-natural-language-processing.html#key-terms-and-concepts-13">Key terms and concepts<span></span></a></li>
<li><a href="text-mining-natural-language-processing.html#exercises-17">Exercises<span></span></a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="cluster-computing.html"><a href="cluster-computing.html"><i class="fa fa-check"></i><b>18</b> Cluster computing<span></span></a>
<ul>
<li><a href="cluster-computing.html#a-paradigm-shift">A paradigm shift<span></span></a></li>
<li><a href="cluster-computing.html#the-drivers">The drivers<span></span></a></li>
<li><a href="cluster-computing.html#the-bottleneck-and-its-solution">The bottleneck and its solution<span></span></a></li>
<li><a href="cluster-computing.html#lambda-architecture">Lambda Architecture<span></span></a></li>
<li><a href="cluster-computing.html#hadoop">Hadoop<span></span></a></li>
<li><a href="cluster-computing.html#spark">Spark<span></span></a></li>
<li><a href="cluster-computing.html#exercises-18">Exercises<span></span></a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="dashboards.html"><a href="dashboards.html"><i class="fa fa-check"></i><b>19</b> Dashboards<span></span></a>
<ul>
<li><a href="dashboards.html#the-value-of-dashboards">The value of dashboards<span></span></a></li>
<li><a href="dashboards.html#designing-a-dashboard">Designing a dashboard<span></span></a></li>
<li><a href="dashboards.html#dashboards-with-r">Dashboards with R<span></span></a></li>
<li><a href="dashboards.html#conclusion-5">Conclusion<span></span></a></li>
<li><a href="dashboards.html#exercises-19">Exercises<span></span></a></li>
</ul></li>
<li><a href="section-4-managing-organizational-memory.html#section-4-managing-organizational-memory">Section 4 Managing Organizational Memory<span></span></a></li>
<li class="chapter" data-level="20" data-path="data-structure-and-storage.html"><a href="data-structure-and-storage.html"><i class="fa fa-check"></i><b>20</b> Data Structure and Storage<span></span></a>
<ul>
<li><a href="data-structure-and-storage.html#the-data-deluge">The data deluge<span></span></a></li>
<li><a href="data-structure-and-storage.html#data-structures-1">Data structures<span></span></a></li>
<li><a href="data-structure-and-storage.html#data-coding-standards">Data coding standards<span></span></a></li>
<li><a href="data-structure-and-storage.html#data-storage-devices">Data storage devices<span></span></a></li>
<li><a href="data-structure-and-storage.html#data-compression">Data compression<span></span></a></li>
<li><a href="data-structure-and-storage.html#key-terms-and-concepts-15">Key terms and concepts<span></span></a></li>
<li><a href="data-structure-and-storage.html#exercises-20">Exercises<span></span></a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="data-processing-architectures.html"><a href="data-processing-architectures.html"><i class="fa fa-check"></i><b>21</b> Data Processing Architectures<span></span></a>
<ul>
<li><a href="data-processing-architectures.html#architectural-choices">Architectural choices<span></span></a></li>
<li><a href="data-processing-architectures.html#remote-job-entry">Remote job entry<span></span></a></li>
<li><a href="data-processing-architectures.html#personal-database">Personal database<span></span></a></li>
<li><a href="data-processing-architectures.html#clientserver">Client/server<span></span></a></li>
<li><a href="data-processing-architectures.html#cloud-computing">Cloud computing<span></span></a></li>
<li><a href="data-processing-architectures.html#distributed-database">Distributed database<span></span></a></li>
<li><a href="data-processing-architectures.html#distributed-data-access">Distributed data access<span></span></a></li>
<li><a href="data-processing-architectures.html#distributed-database-design">Distributed database design<span></span></a></li>
<li><a href="data-processing-architectures.html#key-terms-and-concepts-16">Key terms and concepts<span></span></a></li>
<li><a href="data-processing-architectures.html#exercises-21">Exercises<span></span></a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="sql-and-java.html"><a href="sql-and-java.html"><i class="fa fa-check"></i><b>22</b> SQL and Java<span></span></a>
<ul>
<li><a href="sql-and-java.html#java">JAVA<span></span></a></li>
<li><a href="sql-and-java.html#using-sql-within-java">Using SQL within Java<span></span></a></li>
<li><a href="sql-and-java.html#javaserver-pages-jsp">JavaServer Pages (JSP)<span></span></a></li>
<li><a href="sql-and-java.html#exercises-22">Exercises<span></span></a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="data-integrity.html"><a href="data-integrity.html"><i class="fa fa-check"></i><b>23</b> Data Integrity<span></span></a>
<ul>
<li><a href="data-integrity.html#introduction-2">Introduction<span></span></a></li>
<li><a href="data-integrity.html#transaction-management">Transaction management<span></span></a></li>
<li><a href="data-integrity.html#protecting-existence">Protecting existence<span></span></a></li>
<li><a href="data-integrity.html#maintaining-data-quality">Maintaining data quality<span></span></a></li>
<li><a href="data-integrity.html#ensuring-confidentiality">Ensuring confidentiality<span></span></a></li>
<li><a href="data-integrity.html#key-terms-and-concepts-18">Key terms and concepts<span></span></a></li>
<li><a href="data-integrity.html#exercises-23">Exercises<span></span></a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="data-administration.html"><a href="data-administration.html"><i class="fa fa-check"></i><b>24</b> Data Administration<span></span></a>
<ul>
<li><a href="data-administration.html#introduction-3">Introduction<span></span></a></li>
<li><a href="data-administration.html#the-chief-data-officer">The Chief Data Officer<span></span></a></li>
<li><a href="data-administration.html#management-of-the-database-environment">Management of the database environment<span></span></a></li>
<li><a href="data-administration.html#data-administration-1">Data administration<span></span></a></li>
<li><a href="data-administration.html#database-management-systems-dbmss">Database management systems (DBMSs)<span></span></a></li>
<li><a href="data-administration.html#groupware-1">Groupware<span></span></a></li>
<li><a href="data-administration.html#data-integration">Data integration<span></span></a></li>
<li><a href="data-administration.html#conclusion-9">Conclusion<span></span></a></li>
<li><a href="data-administration.html#exercises-24">Exercises<span></span></a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-one-to-many-relationship" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> The One-to-Many Relationship<a href="the-one-to-many-relationship.html#the-one-to-many-relationship" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<blockquote>
<p><em>Cow of many—well milked and badly fed.</em></p>
<p>Spanish proverb</p>
</blockquote>
<div id="learning-objectives-3" class="section level4 unnumbered hasAnchor">
<h4>Learning Objectives<a href="the-one-to-many-relationship.html#learning-objectives-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Students completing this chapter will be able to</p>
<ul>
<li><p>model a one-to-many relationship between two entities;</p></li>
<li><p>define a database with a one-to-many relationship;</p></li>
<li><p>write queries for a database with a one-to-many relationship.</p></li>
</ul>
</div>
<div id="relationships" class="section level2 unnumbered hasAnchor">
<h2>Relationships<a href="the-one-to-many-relationship.html#relationships" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Entities are not isolated; they are related to other entities. When we move beyond the single entity, we need to identify the relationships between entities to accurately represent the real world. Consider the case where a person’s stocks are listed in different countries. We now need to introduce an entity called NATION. We now have two entities, STOCK and NATION. Consider the relationship between them. A NATION can have many listed stocks. A stock, in this case, is listed in only one nation. There is a 1:m (one-to-many) relationship between NATION and STOCK.</p>
<p>A 1:m relationship between two entities is depicted by a line connecting the two with a crow’s foot at the many end of the relationship. The following figure shows the 1:m relationship between NATION and STOCK. This can be read as: “a nation can have many stocks, but a stock belongs to only one nation.” The entity NATION is identified by <em>nation code</em> and has attributes <em>nation name</em> and <em>exchange rate</em>.</p>
<p><em>A 1:m relationship between NATION and STOCK</em></p>
<p><img src="Figures/Chapter%204/nation-stock.png" width="376" /></p>
<p>The 1:m relationship occurs frequently in business situations. Sometimes it occurs in a tree or hierarchical fashion. Consider a very hierarchical firm. It has many divisions, but a division belongs to only one firm. A division has many departments, but a department belongs to only one division. A department has many sections, but a section belongs to only one department.</p>
<p><em>A series of 1:m relationships</em></p>
<p><img src="Figures/Chapter%204/hierarchy.png" /></p>
<div id="why-did-we-create-an-additional-entity" class="section level3 unnumbered hasAnchor">
<h3>Why did we create an additional entity?<a href="the-one-to-many-relationship.html#why-did-we-create-an-additional-entity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Another approach to adding data about listing nation and exchange rate is to add two attributes to STOCK: <em>nation name</em> and <em>exchange rate</em>. At first glance, this seems a very workable solution; however, this will introduce considerable redundancy, as the following table illustrates.</p>
<p><em>The table stock with additional columns</em></p>
<table>
<colgroup>
<col width="11%" />
<col width="22%" />
<col width="10%" />
<col width="9%" />
<col width="8%" />
<col width="7%" />
<col width="17%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">*stkcode</th>
<th align="left">stkfirm</th>
<th align="right">stkprice</th>
<th align="right">stkqty</th>
<th align="right">stkdiv</th>
<th align="right">stkpe</th>
<th align="left">natname</th>
<th align="right">exchrate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">FC</td>
<td align="left">Freedonia Copper</td>
<td align="right">27.5</td>
<td align="right">10529</td>
<td align="right">1.84</td>
<td align="right">16</td>
<td align="left">United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">PT</td>
<td align="left">Patagonian Tea</td>
<td align="right">55.25</td>
<td align="right">12635</td>
<td align="right">2.5</td>
<td align="right">10</td>
<td align="left">United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">AR</td>
<td align="left">Abyssinian Ruby</td>
<td align="right">31.82</td>
<td align="right">22010</td>
<td align="right">1.32</td>
<td align="right">13</td>
<td align="left">United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">SLG</td>
<td align="left">Sri Lankan Gold</td>
<td align="right">50.37</td>
<td align="right">32868</td>
<td align="right">2.68</td>
<td align="right">16</td>
<td align="left">United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">ILZ</td>
<td align="left">Indian Lead &amp; Zinc</td>
<td align="right">37.75</td>
<td align="right">6390</td>
<td align="right">3</td>
<td align="right">12</td>
<td align="left">United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">BE</td>
<td align="left">Burmese Elephant</td>
<td align="right">0.07</td>
<td align="right">154713</td>
<td align="right">0.01</td>
<td align="right">3</td>
<td align="left">United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">BS</td>
<td align="left">Bolivian Sheep</td>
<td align="right">12.75</td>
<td align="right">231678</td>
<td align="right">1.78</td>
<td align="right">11</td>
<td align="left">United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">NG</td>
<td align="left">Nigerian Geese</td>
<td align="right">35</td>
<td align="right">12323</td>
<td align="right">1.68</td>
<td align="right">10</td>
<td align="left">United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">CS</td>
<td align="left">Canadian Sugar</td>
<td align="right">52.78</td>
<td align="right">4716</td>
<td align="right">2.5</td>
<td align="right">15</td>
<td align="left">United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">ROF</td>
<td align="left">Royal Ostrich Farms</td>
<td align="right">33.75</td>
<td align="right">1234923</td>
<td align="right">3</td>
<td align="right">6</td>
<td align="left">United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">MG</td>
<td align="left">Minnesota Gold</td>
<td align="right">53.87</td>
<td align="right">816122</td>
<td align="right">1</td>
<td align="right">25</td>
<td align="left">USA</td>
<td align="right">0.67</td>
</tr>
<tr class="even">
<td align="left">GP</td>
<td align="left">Georgia Peach</td>
<td align="right">2.35</td>
<td align="right">387333</td>
<td align="right">0.2</td>
<td align="right">5</td>
<td align="left">USA</td>
<td align="right">0.67</td>
</tr>
<tr class="odd">
<td align="left">NE</td>
<td align="left">Narembeen Emu</td>
<td align="right">12.34</td>
<td align="right">45619</td>
<td align="right">1</td>
<td align="right">8</td>
<td align="left">Australia</td>
<td align="right">0.46</td>
</tr>
<tr class="even">
<td align="left">QD</td>
<td align="left">Queensland Diamond</td>
<td align="right">6.73</td>
<td align="right">89251</td>
<td align="right">0.5</td>
<td align="right">7</td>
<td align="left">Australia</td>
<td align="right">0.46</td>
</tr>
<tr class="odd">
<td align="left">IR</td>
<td align="left">Indooroopilly Ruby</td>
<td align="right">15.92</td>
<td align="right">56147</td>
<td align="right">0.5</td>
<td align="right">20</td>
<td align="left">Australia</td>
<td align="right">0.46</td>
</tr>
<tr class="even">
<td align="left">BD</td>
<td align="left">Bombay Duck</td>
<td align="right">25.55</td>
<td align="right">167382</td>
<td align="right">1</td>
<td align="right">12</td>
<td align="left">India</td>
<td align="right">0.0228</td>
</tr>
</tbody>
</table>
<p>The exact same nation name and exchange rate pair occurs 10 times for stocks listed in the United Kingdom. This redundancy presents problems when we want to insert, delete, or update data. These problems, generally known as <strong>update anomalies</strong>, occur with these three basic operations.</p>
<div id="insert-anomalies" class="section level4 unnumbered hasAnchor">
<h4>Insert anomalies<a href="the-one-to-many-relationship.html#insert-anomalies" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We cannot insert a fact about a nation’s exchange rate unless we first buy a stock that is listed in that nation. Consider the case where we want to keep a record of France’s exchange rate and we have no French stocks. We cannot skirt this problem by putting in a null entry for stock details because stkcode, the primary key, would be null, and this is not allowed. If we have a separate table for facts about a nation, then we can easily add new nations without having to buy stocks. This is particularly useful when other parts of the organization, say International Trading, also need access to exchange rates for many nations.</p>
</div>
<div id="delete-anomalies" class="section level4 unnumbered hasAnchor">
<h4>Delete anomalies<a href="the-one-to-many-relationship.html#delete-anomalies" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If we delete data about a particular stock, we might also lose a fact about exchange rates. For example, if we delete details of Bombay Duck, we also erase the Indian exchange rate.</p>
</div>
<div id="update-anomalies" class="section level4 unnumbered hasAnchor">
<h4>Update anomalies<a href="the-one-to-many-relationship.html#update-anomalies" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Exchange rates are volatile. Most companies need to update them every day. What happens when the Australian exchange rate changes? Every row in stock with nation = ‘Australia’ will have to be updated. In a large portfolio, many rows will be changed. There is also the danger of someone forgetting to update all the instances of the nation and exchange rate pair. As a result, there could be two exchange rates for the one nation. If exchange rate is stored in a nation table, however, only one change is necessary, there is no redundancy, and there is no danger of inconsistent exchange rates.</p>
</div>
</div>
</div>
<div id="creating-a-database-with-a-1m-relationship" class="section level2 unnumbered hasAnchor">
<h2>Creating a database with a 1:m relationship<a href="the-one-to-many-relationship.html#creating-a-database-with-a-1m-relationship" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As before, each entity becomes a table in a relational database, the entity name becomes the table name, each attribute becomes a column, and each identifier becomes a primary key. The 1:m relationship is mapped by adding a column to the entity at the many end of the relationship. The additional column contains the identifier of the one end of the relationship.</p>
<p>Consider the relationship between the entities STOCK and NATION. The database has two tables: <code>stock</code> and <code>nation.</code> The table stock has an additional column, natcode, which contains the primary key of nation. If natcode is not stored in <code>stock</code>, then there is no way of knowing the identity of the nation where the <code>stock</code> is listed.</p>
<p><em>A relational database with tables nation and stock</em></p>
<table>
<thead>
<tr class="header">
<th align="left">nation</th>
<th></th>
<th align="right"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">*natcode</td>
<td>natname</td>
<td align="right">exchrate</td>
</tr>
<tr class="even">
<td align="left">AUS</td>
<td>Australia</td>
<td align="right">0.46</td>
</tr>
<tr class="odd">
<td align="left">IND</td>
<td>India</td>
<td align="right">0.0228</td>
</tr>
<tr class="even">
<td align="left">UK</td>
<td>United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">USA</td>
<td>United States</td>
<td align="right">0.67</td>
</tr>
</tbody>
</table>
<table style="width:100%;">
<colgroup>
<col width="13%" />
<col width="26%" />
<col width="12%" />
<col width="13%" />
<col width="10%" />
<col width="8%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">stock</th>
<th></th>
<th align="right"></th>
<th align="right"></th>
<th align="right"></th>
<th align="right"></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">*stkcode</td>
<td>stkfirm</td>
<td align="right">stkprice</td>
<td align="right">stkqty</td>
<td align="right">stkdiv</td>
<td align="right">stkpe</td>
<td><em>natcode</em></td>
</tr>
<tr class="even">
<td align="left">FC</td>
<td>Freedonia Copper</td>
<td align="right">27.5</td>
<td align="right">10,529</td>
<td align="right">1.84</td>
<td align="right">16</td>
<td>UK</td>
</tr>
<tr class="odd">
<td align="left">PT</td>
<td>Patagonian Tea</td>
<td align="right">55.25</td>
<td align="right">12,635</td>
<td align="right">2.5</td>
<td align="right">10</td>
<td>UK</td>
</tr>
<tr class="even">
<td align="left">AR</td>
<td>Abyssinian Ruby</td>
<td align="right">31.82</td>
<td align="right">22,010</td>
<td align="right">1.32</td>
<td align="right">13</td>
<td>UK</td>
</tr>
<tr class="odd">
<td align="left">SLG</td>
<td>Sri Lankan Gold</td>
<td align="right">50.37</td>
<td align="right">32,868</td>
<td align="right">2.68</td>
<td align="right">16</td>
<td>UK</td>
</tr>
<tr class="even">
<td align="left">ILZ</td>
<td>Indian Lead &amp; Zinc</td>
<td align="right">37.75</td>
<td align="right">6,390</td>
<td align="right">3</td>
<td align="right">12</td>
<td>UK</td>
</tr>
<tr class="odd">
<td align="left">BE</td>
<td>Burmese Elephant</td>
<td align="right">0.07</td>
<td align="right">154,713</td>
<td align="right">0.01</td>
<td align="right">3</td>
<td>UK</td>
</tr>
<tr class="even">
<td align="left">BS</td>
<td>Bolivian Sheep</td>
<td align="right">12.75</td>
<td align="right">231,678</td>
<td align="right">1.78</td>
<td align="right">11</td>
<td>UK</td>
</tr>
<tr class="odd">
<td align="left">NG</td>
<td>Nigerian Geese</td>
<td align="right">35</td>
<td align="right">12,323</td>
<td align="right">1.68</td>
<td align="right">10</td>
<td>UK</td>
</tr>
<tr class="even">
<td align="left">CS</td>
<td>Canadian Sugar</td>
<td align="right">52.78</td>
<td align="right">4,716</td>
<td align="right">2.5</td>
<td align="right">15</td>
<td>UK</td>
</tr>
<tr class="odd">
<td align="left">ROF</td>
<td>Royal Ostrich Farms</td>
<td align="right">33.75</td>
<td align="right">1,234,923</td>
<td align="right">3</td>
<td align="right">6</td>
<td>UK</td>
</tr>
<tr class="even">
<td align="left">MG</td>
<td>Minnesota Gold</td>
<td align="right">53.87</td>
<td align="right">816,122</td>
<td align="right">1</td>
<td align="right">25</td>
<td>USA</td>
</tr>
<tr class="odd">
<td align="left">GP</td>
<td>Georgia Peach</td>
<td align="right">2.35</td>
<td align="right">387,333</td>
<td align="right">0.2</td>
<td align="right">5</td>
<td>USA</td>
</tr>
<tr class="even">
<td align="left">NE</td>
<td>Narembeen Emu</td>
<td align="right">12.34</td>
<td align="right">45,619</td>
<td align="right">1</td>
<td align="right">8</td>
<td>AUS</td>
</tr>
<tr class="odd">
<td align="left">QD</td>
<td>Queensland Diamond</td>
<td align="right">6.73</td>
<td align="right">89,251</td>
<td align="right">0.5</td>
<td align="right">7</td>
<td>AUS</td>
</tr>
<tr class="even">
<td align="left">IR</td>
<td>Indooroopilly Ruby</td>
<td align="right">15.92</td>
<td align="right">56,147</td>
<td align="right">0.5</td>
<td align="right">20</td>
<td>AUS</td>
</tr>
<tr class="odd">
<td align="left">BD</td>
<td>Bombay Duck</td>
<td align="right">25.55</td>
<td align="right">167,382</td>
<td align="right">1</td>
<td align="right">12</td>
<td>IND</td>
</tr>
</tbody>
</table>
<p>Notice that <code>natcode</code> appears in both the <code>stock</code> and <code>nation</code> tables. In <code>nation</code>, <code>natcode</code> is the primary key; it is unique for each instance of <code>nation.</code> In table <code>stock</code>, <code>natcode</code> is a <strong>foreign key</strong> because it is the primary key of <code>nation</code>, the one end of the 1:m relationship. The column <code>natcode</code> is a foreign key in <code>stock</code> because it is a primary key in <code>nation</code>. A matched primary key–foreign key pair is the method for recording the 1:m relationship between the two tables. This method of representing a relationship is illustrated using shading and arrows for the two USA stocks. In the <code>stock</code> table, <code>natcode</code> is italicized to indicate that it is a foreign key. This method, like asterisking a primary key, is a useful reminder.</p>
<p>Although the same name has been used for the primary key and the foreign key in this example, it is not mandatory. The two columns can have different names, and in some cases you are forced to use different names. When possible, we find it convenient to use identical column names to help us remember that the tables are related. To distinguish between columns with identical names, they must by <strong>qualified</strong> by prefixing the table name. In this case, use <code>nation.natcode</code> and <code>stock.natcode.</code> Thus, <code>nation.natcode</code> refers to the <code>natcode</code> column in the table <code>nation.</code></p>
<p>Although a nation can have many stocks, it is not mandatory to have any. That is, in data modeling terminology, many can be zero, one, or more, but it is mandatory to have a value for <code>natcode</code> in <code>nation</code> for every value of <code>natcode</code> in <code>stock</code>. This requirement, known as the <strong>referential integrity constraint</strong>, helps maintain the accuracy of a database. Its application means that every foreign key in a table has an identical primary key in that same table or another table. In this example, it means that for every value of <code>natcode</code> in <code>stock</code>, there is a corresponding entry in <code>nation</code>. As a result, a primary key row must be created before its corresponding foreign key row. In other words, details for a <code>nation</code> must be added before any data about its listed stocks are entered.</p>
<p>Every foreign key must have a matching primary key (referential integrity rule), and every primary key must be non-null (entity integrity rule). A foreign key cannot be null when a relationship is mandatory, as in the case where a stock must belong to a nation. If a relationship is optional (a person can have a boss), then a foreign key can be null (i.e., a person is the head of the organization, and thus has no boss). The ideas of mandatory and optional will be discussed later in this book.</p>
<p>Why is the foreign key in the table at the “many” end of the relationship? Because each instance of <code>stock</code> is associated with exactly one instance of <code>nation</code>. The rule is that a <code>stock</code> must be listed in one, and only one, nation. Thus, the foreign key field is single-valued when it is at the “many” end of a relationship. The foreign key is not at the “one” end of the relationship because each instance of nation can be associated with more than one instance of <code>stock</code>, and this implies a multivalued foreign key. The relational model does not support multivalued fields.</p>
<p>Using SQL, the two tables are defined in a similar manner to the way we created a single table in Chapter 3. Here are the SQL statements:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb37-1"><a href="the-one-to-many-relationship.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> nation (</span>
<span id="cb37-2"><a href="the-one-to-many-relationship.html#cb37-2" aria-hidden="true" tabindex="-1"></a>  natcode <span class="dt">CHAR</span>(<span class="dv">3</span>),</span>
<span id="cb37-3"><a href="the-one-to-many-relationship.html#cb37-3" aria-hidden="true" tabindex="-1"></a>  natname <span class="dt">VARCHAR</span>(<span class="dv">20</span>),</span>
<span id="cb37-4"><a href="the-one-to-many-relationship.html#cb37-4" aria-hidden="true" tabindex="-1"></a>  exchrate <span class="dt">DECIMAL</span>(<span class="dv">9</span>,<span class="dv">5</span>),</span>
<span id="cb37-5"><a href="the-one-to-many-relationship.html#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">PRIMARY</span> <span class="kw">KEY</span>(natcode));</span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb38-1"><a href="the-one-to-many-relationship.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> stock (</span>
<span id="cb38-2"><a href="the-one-to-many-relationship.html#cb38-2" aria-hidden="true" tabindex="-1"></a>  stkcode <span class="dt">CHAR</span>(<span class="dv">3</span>),</span>
<span id="cb38-3"><a href="the-one-to-many-relationship.html#cb38-3" aria-hidden="true" tabindex="-1"></a>  stkfirm <span class="dt">VARCHAR</span>(<span class="dv">20</span>),</span>
<span id="cb38-4"><a href="the-one-to-many-relationship.html#cb38-4" aria-hidden="true" tabindex="-1"></a>  stkprice <span class="dt">DECIMAL</span>(<span class="dv">6</span>,<span class="dv">2</span>),</span>
<span id="cb38-5"><a href="the-one-to-many-relationship.html#cb38-5" aria-hidden="true" tabindex="-1"></a>  stkqty <span class="dt">DECIMAL</span>(<span class="dv">8</span>),</span>
<span id="cb38-6"><a href="the-one-to-many-relationship.html#cb38-6" aria-hidden="true" tabindex="-1"></a>  stkdiv <span class="dt">DECIMAL</span>(<span class="dv">5</span>,<span class="dv">2</span>),</span>
<span id="cb38-7"><a href="the-one-to-many-relationship.html#cb38-7" aria-hidden="true" tabindex="-1"></a>  stkpe <span class="dt">DECIMAL</span>(<span class="dv">5</span>),</span>
<span id="cb38-8"><a href="the-one-to-many-relationship.html#cb38-8" aria-hidden="true" tabindex="-1"></a>  natcode <span class="dt">CHAR</span>(<span class="dv">3</span>),</span>
<span id="cb38-9"><a href="the-one-to-many-relationship.html#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">PRIMARY</span> <span class="kw">KEY</span>(stkcode),</span>
<span id="cb38-10"><a href="the-one-to-many-relationship.html#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">CONSTRAINT</span> fk_has_nation <span class="kw">FOREIGN</span> <span class="kw">KEY</span>(natcode)</span>
<span id="cb38-11"><a href="the-one-to-many-relationship.html#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">REFERENCES</span> nation(natcode) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">RESTRICT</span>);</span></code></pre></div>
<p>Notice that the definition of <code>stock</code> includes an additional phrase to specify the foreign key and the referential integrity constraint. The CONSTRAINT clause defines the column or columns in the table being created that constitute the foreign key. A referential integrity constraint can be named, and in this case, the constraint’s name is <code>fk_has_nation</code>. The foreign key is the column <code>natcode</code> in STOCK, and it references the primary key of <code>nation</code>, which is <code>natcode</code>.</p>
<p>The ON DELETE clause specifies what processing should occur if an attempt is made to delete a row in <code>nation</code> with a primary key that is a foreign key in <code>stock</code>. In this case, the ON DELETE clause specifies that it is not permissible (the meaning of RESTRICT) to delete a primary key row in <code>nation</code> while a corresponding foreign key in <code>stock</code> exists. In other words, the system will not execute the delete. You must first delete all corresponding rows in <code>stock</code> before attempting to delete the row containing the primary key. ON DELETE is the default clause for most RDBMSs, so we will dispense with specifying it for future foreign key constraints.</p>
<p>Observe that both the primary and foreign keys are defined as CHAR(3). The relational model requires that a primary key–foreign key pair have the same data type and are the same length.</p>
<blockquote>
<p>❓ <em>Skill builder</em></p>
<p>The university architect has asked you to develop a data model to record details of campus buildings. A building can have many rooms, but a room can be in only one building. Buildings have names, and rooms have a size and purpose (e.g., lecture, laboratory, seminar). Draw a data model for this situation and create the matching relational database.</p>
</blockquote>
<div id="mysql-workbench" class="section level3 unnumbered hasAnchor">
<h3>MySQL Workbench<a href="the-one-to-many-relationship.html#mysql-workbench" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In Workbench, a 1:m relationship is represented in a similar manner to the method you have just learned. Also, note that the foreign key is shown in the entity at the many end with a red diamond. We omit the foreign key when data modeling because it can be inferred. You will observe some additional symbols on the line between the two entities, and these will be explained later, but take note of the crow’s foot indicating the 1:m relationship between nation and stock. Because Workbench can generate automatically the SQL to create the tables,<a href="data-administration.html#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a> we use lowercase table names and abbreviated column names.</p>
<p><em>Specifying a 1:m relationship in MySQL Workbench</em></p>
<p><img src="Figures/Chapter%204/wb-stock-nation.png" /></p>
</div>
</div>
<div id="querying-a-two-table-database" class="section level2 unnumbered hasAnchor">
<h2>Querying a two-table database<a href="the-one-to-many-relationship.html#querying-a-two-table-database" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A two-table database offers the opportunity to learn more SQL and another relational algebra operation: join.</p>
<div id="join" class="section level3 unnumbered hasAnchor">
<h3>Join<a href="the-one-to-many-relationship.html#join" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Join creates a new table from two existing tables by matching on a column common to both tables. Usually, the common column is a primary key–foreign key pair: The primary key of one table is matched with the foreign key of another table. Join is frequently used to get the data for a query into a single row. Consider the tables <code>nation</code> and <code>stock</code>. If we want to calculate the value—in British pounds—of a stock, we multiply stock price by stock quantity and then exchange rate. To find the appropriate exchange rate for a stock, get its <code>natcode</code> from stock and then find the exchange rate in the matching row in <code>nation</code>, the one with the same value for <code>natcode</code>. For example, to calculate the value of Georgia Peach, which has <code>natcode</code> = ‘US’, find the row in <code>nation</code> that also has <code>natcode</code> = ‘US’. In this case, the stock’s value is 2.35 * 387333 / 0.67 = £609,855.81.</p>
<p>Calculation of stock value is very easy once a join is used to get the three values in one row. The SQL command for joining the two tables is:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb39-1"><a href="the-one-to-many-relationship.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> stock <span class="kw">JOIN</span> nation</span>
<span id="cb39-2"><a href="the-one-to-many-relationship.html#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ON</span> stock.natcode <span class="op">=</span> nation.natcode;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-38">Table 4.1: </span>Displaying records 1 - 10</caption>
<colgroup>
<col width="8%" />
<col width="19%" />
<col width="9%" />
<col width="7%" />
<col width="7%" />
<col width="6%" />
<col width="8%" />
<col width="8%" />
<col width="15%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">stkcode</th>
<th align="left">stkfirm</th>
<th align="right">stkprice</th>
<th align="right">stkqty</th>
<th align="right">stkdiv</th>
<th align="right">stkpe</th>
<th align="left">natcode</th>
<th align="left">natcode</th>
<th align="left">natname</th>
<th align="right">exchrate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">AR</td>
<td align="left">Abyssinian Ruby</td>
<td align="right">31.82</td>
<td align="right">22010</td>
<td align="right">1.32</td>
<td align="right">13</td>
<td align="left">UK</td>
<td align="left">UK</td>
<td align="left">United Kingdom</td>
<td align="right">1.0000</td>
</tr>
<tr class="even">
<td align="left">BD</td>
<td align="left">Bombay Duck</td>
<td align="right">25.55</td>
<td align="right">167382</td>
<td align="right">1.00</td>
<td align="right">12</td>
<td align="left">IND</td>
<td align="left">IND</td>
<td align="left">India</td>
<td align="right">0.0228</td>
</tr>
<tr class="odd">
<td align="left">BE</td>
<td align="left">Burmese Elephant</td>
<td align="right">0.07</td>
<td align="right">154713</td>
<td align="right">0.01</td>
<td align="right">3</td>
<td align="left">UK</td>
<td align="left">UK</td>
<td align="left">United Kingdom</td>
<td align="right">1.0000</td>
</tr>
<tr class="even">
<td align="left">BS</td>
<td align="left">Bolivian Sheep</td>
<td align="right">12.75</td>
<td align="right">231678</td>
<td align="right">1.78</td>
<td align="right">11</td>
<td align="left">UK</td>
<td align="left">UK</td>
<td align="left">United Kingdom</td>
<td align="right">1.0000</td>
</tr>
<tr class="odd">
<td align="left">CS</td>
<td align="left">Canadian Sugar</td>
<td align="right">52.78</td>
<td align="right">4716</td>
<td align="right">2.50</td>
<td align="right">15</td>
<td align="left">UK</td>
<td align="left">UK</td>
<td align="left">United Kingdom</td>
<td align="right">1.0000</td>
</tr>
<tr class="even">
<td align="left">FC</td>
<td align="left">Freedonia Copper</td>
<td align="right">30.00</td>
<td align="right">1000</td>
<td align="right">1.84</td>
<td align="right">16</td>
<td align="left">UK</td>
<td align="left">UK</td>
<td align="left">United Kingdom</td>
<td align="right">1.0000</td>
</tr>
<tr class="odd">
<td align="left">GP</td>
<td align="left">Georgia Peach</td>
<td align="right">2.35</td>
<td align="right">387333</td>
<td align="right">0.20</td>
<td align="right">5</td>
<td align="left">USA</td>
<td align="left">USA</td>
<td align="left">United States</td>
<td align="right">0.6700</td>
</tr>
<tr class="even">
<td align="left">ILZ</td>
<td align="left">Indian Lead &amp; Zinc</td>
<td align="right">37.75</td>
<td align="right">6390</td>
<td align="right">3.00</td>
<td align="right">12</td>
<td align="left">UK</td>
<td align="left">UK</td>
<td align="left">United Kingdom</td>
<td align="right">1.0000</td>
</tr>
<tr class="odd">
<td align="left">IR</td>
<td align="left">Indooroopilly Ruby</td>
<td align="right">15.92</td>
<td align="right">56147</td>
<td align="right">0.50</td>
<td align="right">20</td>
<td align="left">AUS</td>
<td align="left">AUS</td>
<td align="left">Australia</td>
<td align="right">0.4600</td>
</tr>
<tr class="even">
<td align="left">MG</td>
<td align="left">Minnesota Gold</td>
<td align="right">53.87</td>
<td align="right">816122</td>
<td align="right">1.00</td>
<td align="right">25</td>
<td align="left">USA</td>
<td align="left">USA</td>
<td align="left">United States</td>
<td align="right">0.6700</td>
</tr>
</tbody>
</table>
</div>
<p><em>The join of stock and nation</em></p>
<p>The columns <code>stkprice</code> and <code>stkdiv</code> record values in the country’s currency. Thus, the price of Bombay Duck is 25.55 Indian rupees. To find the value in U.K. pounds (GPB), multiply the price by 0.0228, because one rupee is worth 0.0228 GPB. The value of one share of Bombay Duck in U.S. dollars (USD) is 25.55 * 0.0228 / 0.67 because one USD is worth 0.67 GBP.</p>
<p>There are several things to notice about the SQL command and the result:</p>
<ul>
<li><p>To avoid confusion because <code>natcode</code> is a column name in both stock and nation, it needs to be qualified. If <code>natcode</code> is not qualified, the system will reject the query because it cannot distinguish between the two columns titled <code>natcode</code>.</p></li>
<li><p>The new table has the <code>natcode</code> column replicated. Both are called <code>natcode</code>. The naming convention for the replicated column varies with the RDBMS. The columns, for example, should be labeled <code>stock.natcode</code> and <code>nation.natcode</code>.</p></li>
<li><p>The SQL command specifies the names of the tables to be joined, the columns to be used for matching, and the condition for the match (equality in this case).</p></li>
<li><p>The number of columns in the new table is the sum of the columns in the two tables.</p></li>
<li><p>The stock value calculation is now easily specified in an SQL command because all the data are in one row.</p></li>
</ul>
<p>Remember that during data modeling we created two entities, STOCK and NATION, and defined the relationship between them. We showed that if the data were stored in one table, there could be updating problems. Now, with a join, we have combined these data. So why separate the data only to put them back together later? There are two reasons. First, we want to avoid update anomalies. Second, as you will discover, we do not join the same tables every time.</p>
<p>Join comes in several flavors. The matching condition can be =, &lt;&gt;, &lt;=, &lt;, &gt;=, and &gt;. This generalized version is called a <strong>theta join</strong>. Generally, when people refer to a join, they mean an equijoin, when the matching condition is equality.</p>
<p>A join can be combined with other SQL commands.</p>
<p><em>Report the value of each stockholding in UK pounds. Sort the report by nation and firm.</em></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb40-1"><a href="the-one-to-many-relationship.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> natname, stkfirm, stkprice, stkqty, exchrate,</span>
<span id="cb40-2"><a href="the-one-to-many-relationship.html#cb40-2" aria-hidden="true" tabindex="-1"></a>    stkprice<span class="op">*</span>stkqty<span class="op">*</span>exchrate <span class="kw">as</span> stkvalue</span>
<span id="cb40-3"><a href="the-one-to-many-relationship.html#cb40-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">FROM</span> stock <span class="kw">JOIN</span> nation</span>
<span id="cb40-4"><a href="the-one-to-many-relationship.html#cb40-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">ON</span> stock.natcode <span class="op">=</span> nation.natcode</span>
<span id="cb40-5"><a href="the-one-to-many-relationship.html#cb40-5" aria-hidden="true" tabindex="-1"></a>                <span class="kw">ORDER</span> <span class="kw">BY</span> natname, stkfirm;</span></code></pre></div>
<div class="knitsql-table">
<table style="width:100%;">
<caption><span id="tab:unnamed-chunk-39">Table 4.2: </span>Displaying records 1 - 10</caption>
<colgroup>
<col width="21%" />
<col width="27%" />
<col width="12%" />
<col width="10%" />
<col width="12%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">natname</th>
<th align="left">stkfirm</th>
<th align="right">stkprice</th>
<th align="right">stkqty</th>
<th align="right">exchrate</th>
<th align="right">stkvalue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Australia</td>
<td align="left">Indooroopilly Ruby</td>
<td align="right">15.92</td>
<td align="right">56147</td>
<td align="right">0.4600</td>
<td align="right">411175.71</td>
</tr>
<tr class="even">
<td align="left">Australia</td>
<td align="left">Narembeen Emu</td>
<td align="right">12.34</td>
<td align="right">45619</td>
<td align="right">0.4600</td>
<td align="right">258951.69</td>
</tr>
<tr class="odd">
<td align="left">Australia</td>
<td align="left">Queensland Diamond</td>
<td align="right">6.73</td>
<td align="right">89251</td>
<td align="right">0.4600</td>
<td align="right">276303.25</td>
</tr>
<tr class="even">
<td align="left">India</td>
<td align="left">Bombay Duck</td>
<td align="right">25.55</td>
<td align="right">167382</td>
<td align="right">0.0228</td>
<td align="right">97506.71</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="left">Abyssinian Ruby</td>
<td align="right">31.82</td>
<td align="right">22010</td>
<td align="right">1.0000</td>
<td align="right">700358.20</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="left">Bolivian Sheep</td>
<td align="right">12.75</td>
<td align="right">231678</td>
<td align="right">1.0000</td>
<td align="right">2953894.50</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="left">Burmese Elephant</td>
<td align="right">0.07</td>
<td align="right">154713</td>
<td align="right">1.0000</td>
<td align="right">10829.91</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="left">Canadian Sugar</td>
<td align="right">52.78</td>
<td align="right">4716</td>
<td align="right">1.0000</td>
<td align="right">248910.48</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="left">Freedonia Copper</td>
<td align="right">30.00</td>
<td align="right">1000</td>
<td align="right">1.0000</td>
<td align="right">30000.00</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="left">Indian Lead &amp; Zinc</td>
<td align="right">37.75</td>
<td align="right">6390</td>
<td align="right">1.0000</td>
<td align="right">241222.50</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="control-break-reporting" class="section level3 unnumbered hasAnchor">
<h3>Control break reporting<a href="the-one-to-many-relationship.html#control-break-reporting" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The purpose of a join is to collect the necessary data for a report. When two tables in a 1:m relationship are joined, the report will contain repetitive data. If you re-examine the report from the previous join, you will see that <code>nation</code> and <code>exchrate</code> are often repeated because the same values apply to many stocks. A more appropriate format is shown in the following figure, an example of a <strong>control break report</strong>.</p>
<table>
<colgroup>
<col width="18%" />
<col width="24%" />
<col width="17%" />
<col width="8%" />
<col width="12%" />
<col width="17%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Nation</th>
<th></th>
<th align="right">Exchange rate</th>
<th align="right"></th>
<th align="right"></th>
<th align="right"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"></td>
<td>Firm</td>
<td align="right"></td>
<td align="right">Price</td>
<td align="right">Quantity</td>
<td align="right">Value</td>
</tr>
<tr class="even">
<td align="left">Australia</td>
<td></td>
<td align="right">0.46</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td>Indooroopilly Ruby</td>
<td align="right"></td>
<td align="right">15.92</td>
<td align="right">56,147</td>
<td align="right">411,175.71</td>
</tr>
<tr class="even">
<td align="left"></td>
<td>Narembeen Emu</td>
<td align="right"></td>
<td align="right">12.34</td>
<td align="right">45,619</td>
<td align="right">258,951.69</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td>Queensland Diamond</td>
<td align="right"></td>
<td align="right">6.73</td>
<td align="right">89,251</td>
<td align="right">276,303.25</td>
</tr>
<tr class="even">
<td align="left">India</td>
<td></td>
<td align="right">0.0228</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td>Bombay Duck</td>
<td align="right"></td>
<td align="right">25.55</td>
<td align="right">167,382</td>
<td align="right">97,506.71</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td></td>
<td align="right">0.0228</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td>Abyssinian Ruby</td>
<td align="right"></td>
<td align="right">31.82</td>
<td align="right">22,010</td>
<td align="right">700,358.20</td>
</tr>
<tr class="even">
<td align="left"></td>
<td>Bolivian Sheep</td>
<td align="right"></td>
<td align="right">12.75</td>
<td align="right">231,678</td>
<td align="right">2,953,894.50</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td>Burmese Elephant</td>
<td align="right"></td>
<td align="right">0.07</td>
<td align="right">154,713</td>
<td align="right">10,829.91</td>
</tr>
<tr class="even">
<td align="left"></td>
<td>Canadian Sugar</td>
<td align="right"></td>
<td align="right">52.78</td>
<td align="right">4,716</td>
<td align="right">248,910.48</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td>Freedonia Copper</td>
<td align="right"></td>
<td align="right">27.50</td>
<td align="right">10,529</td>
<td align="right">289,547.50</td>
</tr>
<tr class="even">
<td align="left"></td>
<td>Indian Lead &amp; Zinc</td>
<td align="right"></td>
<td align="right">37.75</td>
<td align="right">6,390</td>
<td align="right">241,222.50</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td>Nigerian Geese</td>
<td align="right"></td>
<td align="right">35.00</td>
<td align="right">12,323</td>
<td align="right">431,305.00</td>
</tr>
<tr class="even">
<td align="left"></td>
<td>Patagonian Tea</td>
<td align="right"></td>
<td align="right">55.25</td>
<td align="right">12,635</td>
<td align="right">698,083.75</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td>Royal Ostrich Farms</td>
<td align="right"></td>
<td align="right">33.75</td>
<td align="right">1,234,923</td>
<td align="right">41,678,651.25</td>
</tr>
<tr class="even">
<td align="left"></td>
<td>Sri Lankan Gold</td>
<td align="right"></td>
<td align="right">50.37</td>
<td align="right">32,868</td>
<td align="right">1,655,561.16</td>
</tr>
<tr class="odd">
<td align="left">United States</td>
<td></td>
<td align="right">0.0228</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left"></td>
<td>Georgia Peach</td>
<td align="right"></td>
<td align="right">2.35</td>
<td align="right">387,333</td>
<td align="right">609,855.81</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td>Minnesota Gold</td>
<td align="right"></td>
<td align="right">53.87</td>
<td align="right">816,122</td>
<td align="right">29,456,209.73</td>
</tr>
</tbody>
</table>
<p>A control break report recognizes that the values in a particular column or columns seldom change. In this case, <code>natname</code> and <code>exchrate</code> are often the same from one row to the next, so it makes sense to report these data only when they change. The report is also easier to read. The column <code>natname</code> is known as a <em>control field</em>. Notice that there are four groups of data, because <code>natname</code> has four different values.</p>
<p>Many RDBMS packages have report-writing languages to facilitate creating a control break report. These languages typically support summary reporting for each group of rows having the same value for the control field(s). A table must usually be sorted on the control break field(s) before the report is created.</p>
<div id="group-byreporting-by-groups" class="section level4 unnumbered hasAnchor">
<h4>GROUP BY—reporting by groups<a href="the-one-to-many-relationship.html#group-byreporting-by-groups" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The GROUP BY clause is an elementary form of control break reporting. It permits grouping of rows that have the same value for a specified column or columns, and it produces one row for each different value of the grouping column(s).</p>
<p><em>Report by nation the total value of stockholdings.</em></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb41-1"><a href="the-one-to-many-relationship.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> natname, <span class="fu">sum</span>(stkprice<span class="op">*</span>stkqty<span class="op">*</span>exchrate) <span class="kw">as</span> stkvalue</span>
<span id="cb41-2"><a href="the-one-to-many-relationship.html#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> stock <span class="kw">JOIN</span> nation <span class="kw">ON</span> stock.natcode <span class="op">=</span> nation.natcode</span>
<span id="cb41-3"><a href="the-one-to-many-relationship.html#cb41-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">GROUP</span> <span class="kw">BY</span> natname;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-40">Table 4.3: </span>4 records</caption>
<thead>
<tr class="header">
<th align="left">natname</th>
<th align="right">stkvalue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Australia</td>
<td align="right">946430.65</td>
</tr>
<tr class="even">
<td align="left">India</td>
<td align="right">97506.71</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="right">48648816.75</td>
</tr>
<tr class="even">
<td align="left">United States</td>
<td align="right">30066065.54</td>
</tr>
</tbody>
</table>
</div>
<p>SQL’s built-in functions (COUNT, SUM, AVERAGE, MIN, and MAX) can be used with the GROUP BY clause. They are applied to a group of rows having the same value for a specified column. You can specify more than one function in a SELECT statement. For example, we can compute total value and number of different stocks and group by nation using:</p>
<p><em>Report the number of stocks and their total value by nation.</em></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb42-1"><a href="the-one-to-many-relationship.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> natname, <span class="fu">COUNT</span>(<span class="op">*</span>), <span class="fu">SUM</span>(stkprice<span class="op">*</span>stkqty<span class="op">*</span>exchrate) <span class="kw">AS</span> stkvalue</span>
<span id="cb42-2"><a href="the-one-to-many-relationship.html#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> stock <span class="kw">JOIN</span> nation <span class="kw">ON</span> stock.natcode <span class="op">=</span> nation.natcode</span>
<span id="cb42-3"><a href="the-one-to-many-relationship.html#cb42-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">GROUP</span> <span class="kw">BY</span> natname;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-41">Table 4.4: </span>4 records</caption>
<thead>
<tr class="header">
<th align="left">natname</th>
<th align="right">COUNT(*)</th>
<th align="right">stkvalue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Australia</td>
<td align="right">3</td>
<td align="right">946430.65</td>
</tr>
<tr class="even">
<td align="left">India</td>
<td align="right">1</td>
<td align="right">97506.71</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="right">10</td>
<td align="right">48648816.75</td>
</tr>
<tr class="even">
<td align="left">United States</td>
<td align="right">2</td>
<td align="right">30066065.54</td>
</tr>
</tbody>
</table>
</div>
<p>You can group by more than one column name; however, all column names appearing in the SELECT clause must be associated with a built-in function or be in a GROUP BY clause.</p>
<p><em>List stocks by nation, and for each nation show the number of stocks for each PE ratio and the total value of those stock holdings in UK pounds.</em></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb43-1"><a href="the-one-to-many-relationship.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> natname,stkpe,<span class="fu">COUNT</span>(<span class="op">*</span>),</span>
<span id="cb43-2"><a href="the-one-to-many-relationship.html#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SUM</span>(stkprice<span class="op">*</span>stkqty<span class="op">*</span>exchrate) <span class="kw">AS</span> stkvalue</span>
<span id="cb43-3"><a href="the-one-to-many-relationship.html#cb43-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">FROM</span> stock <span class="kw">JOIN</span> nation <span class="kw">ON</span> stock.natcode <span class="op">=</span> nation.natcode</span>
<span id="cb43-4"><a href="the-one-to-many-relationship.html#cb43-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">GROUP</span> <span class="kw">BY</span> natname, stkpe;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-42">Table 4.5: </span>Displaying records 1 - 14</caption>
<thead>
<tr class="header">
<th align="left">natname</th>
<th align="right">stkpe</th>
<th align="right">COUNT(*)</th>
<th align="right">stkvalue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Australia</td>
<td align="right">20</td>
<td align="right">1</td>
<td align="right">411175.71</td>
</tr>
<tr class="even">
<td align="left">Australia</td>
<td align="right">8</td>
<td align="right">1</td>
<td align="right">258951.69</td>
</tr>
<tr class="odd">
<td align="left">Australia</td>
<td align="right">7</td>
<td align="right">1</td>
<td align="right">276303.25</td>
</tr>
<tr class="even">
<td align="left">India</td>
<td align="right">12</td>
<td align="right">1</td>
<td align="right">97506.71</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="right">13</td>
<td align="right">1</td>
<td align="right">700358.20</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">10829.91</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="right">11</td>
<td align="right">1</td>
<td align="right">2953894.50</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="right">15</td>
<td align="right">1</td>
<td align="right">248910.48</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="right">16</td>
<td align="right">2</td>
<td align="right">1685561.16</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="right">12</td>
<td align="right">1</td>
<td align="right">241222.50</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="right">10</td>
<td align="right">2</td>
<td align="right">1129388.75</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="right">6</td>
<td align="right">1</td>
<td align="right">41678651.25</td>
</tr>
<tr class="odd">
<td align="left">United States</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">609855.81</td>
</tr>
<tr class="even">
<td align="left">United States</td>
<td align="right">25</td>
<td align="right">1</td>
<td align="right">29456209.73</td>
</tr>
</tbody>
</table>
</div>
<p>In this example, stocks are grouped by both <code>natname</code> and <code>stkpe</code>. In most cases, there is only one stock for each pair of <code>natname</code> and <code>stkpe</code>; however, there are two situations (U.K. stocks with PEs of 10 and 16) where details of multiple stocks are grouped into one report line. Examining the values in the COUNT column helps you to identify these stocks.</p>
</div>
<div id="havingthe-where-clause-of-groups" class="section level4 unnumbered hasAnchor">
<h4>HAVING—the WHERE clause of groups<a href="the-one-to-many-relationship.html#havingthe-where-clause-of-groups" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The HAVING clause in a GROUP BY is like the WHERE clause in a SELECT. It restricts the number of groups reported, whereas WHERE restricts the number of rows reported. Used with built-in functions, HAVING is always preceded by GROUP BY and is always followed by a function (SUM, AVG, MAX, MIN, or COUNT).</p>
<p><em>Report the total value of stocks for nations with two or more listed stocks.</em></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb44-1"><a href="the-one-to-many-relationship.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> natname, <span class="fu">SUM</span>(stkprice<span class="op">*</span>stkqty<span class="op">*</span>exchrate) <span class="kw">AS</span> stkvalue</span>
<span id="cb44-2"><a href="the-one-to-many-relationship.html#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> stock <span class="kw">JOIN</span> nation <span class="kw">ON</span> stock.natcode <span class="op">=</span> nation.natcode</span>
<span id="cb44-3"><a href="the-one-to-many-relationship.html#cb44-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">GROUP</span> <span class="kw">BY</span> natname</span>
<span id="cb44-4"><a href="the-one-to-many-relationship.html#cb44-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">HAVING</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="op">&gt;=</span> <span class="dv">2</span>;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-43">Table 4.6: </span>3 records</caption>
<thead>
<tr class="header">
<th align="left">natname</th>
<th align="right">stkvalue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Australia</td>
<td align="right">946430.6</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="right">48648816.8</td>
</tr>
<tr class="odd">
<td align="left">United States</td>
<td align="right">30066065.5</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>❓ <em>Skill builder</em></p>
<p>Report by nation the total value of dividends.</p>
</blockquote>
</div>
</div>
</div>
<div id="regular-expressionpattern-matching-1" class="section level2 unnumbered hasAnchor">
<h2>Regular expression—pattern matching<a href="the-one-to-many-relationship.html#regular-expressionpattern-matching-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Regular expression was introduced in the previous chapter, and we will now continue to learn some more of its features.</p>
<div id="search-for-a-string-not-containing-specified-characters" class="section level3 unnumbered hasAnchor">
<h3>Search for a string not containing specified characters<a href="the-one-to-many-relationship.html#search-for-a-string-not-containing-specified-characters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The ^ (carat) is the symbol for NOT. It is used when we want to find a string not containing a character in one or more specified strings. For example, [^a-f] means any character not in the set containing a, b, c, d, e, or f.</p>
<p><em>List the names of nations with non-alphabetic characters in their names</em></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb45-1"><a href="the-one-to-many-relationship.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> natname <span class="kw">FROM</span> nation <span class="kw">WHERE</span> natname REGEXP <span class="st">&#39;[^a-z|A-Z]&#39;</span></span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-44">Table 4.7: </span>2 records</caption>
<thead>
<tr class="header">
<th align="left">natname</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">United Kingdom</td>
</tr>
<tr class="even">
<td align="left">United States</td>
</tr>
</tbody>
</table>
</div>
<p>Notice that the nations reported have a space in their name, which is a character not in the range a-z and not in A-Z.</p>
</div>
<div id="search-for-string-containing-a-repeated-pattern-or-repetition" class="section level3 unnumbered hasAnchor">
<h3>Search for string containing a repeated pattern or repetition<a href="the-one-to-many-relationship.html#search-for-string-containing-a-repeated-pattern-or-repetition" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A pair of curly brackets is used to denote the repetition factor for a pattern. For example, {n} means repeat a specified pattern n times.</p>
<p><em>List the names of firms with a double ‘e’.</em></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb46-1"><a href="the-one-to-many-relationship.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> stkfirm <span class="kw">FROM</span> stock <span class="kw">WHERE</span> stkfirm REGEXP <span class="st">&#39;[e]{2}&#39;</span>;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-45">Table 4.8: </span>5 records</caption>
<thead>
<tr class="header">
<th align="left">stkfirm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Bolivian Sheep</td>
</tr>
<tr class="even">
<td align="left">Freedonia Copper</td>
</tr>
<tr class="odd">
<td align="left">Narembeen Emu</td>
</tr>
<tr class="even">
<td align="left">Nigerian Geese</td>
</tr>
<tr class="odd">
<td align="left">Queensland Diamond</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="search-combining-alternation-and-repetition" class="section level3 unnumbered hasAnchor">
<h3>Search combining alternation and repetition<a href="the-one-to-many-relationship.html#search-combining-alternation-and-repetition" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Regular expressions becomes very powerful when you combine several of the basic capabilities into a single search expression.</p>
<p><em>List the names of firms with a double ‘s’ or a double ‘n’.</em></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb47-1"><a href="the-one-to-many-relationship.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> stkfirm <span class="kw">FROM</span> stock <span class="kw">WHERE</span> stkfirm REGEXP <span class="st">&#39;[s]{2}|[n]{2}&#39;</span>;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-46">Table 4.9: </span>2 records</caption>
<thead>
<tr class="header">
<th align="left">stkfirm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Abyssinian Ruby</td>
</tr>
<tr class="even">
<td align="left">Minnesota Gold</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="search-for-multiple-versions-of-a-string" class="section level3 unnumbered hasAnchor">
<h3>Search for multiple versions of a string<a href="the-one-to-many-relationship.html#search-for-multiple-versions-of-a-string" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you are interested in find a string containing several specified string, you can use the square brackets to indicate the sought strings. For example, [ea] means any character from the set containing e and a.</p>
<p><em>List the names of firms with names that include ‘inia’ or ‘onia’.</em></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb48-1"><a href="the-one-to-many-relationship.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> stkfirm <span class="kw">FROM</span> stock <span class="kw">WHERE</span> stkfirm REGEXP <span class="st">&#39;[io]nia&#39;</span>;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-47">Table 4.10: </span>3 records</caption>
<thead>
<tr class="header">
<th align="left">stkfirm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Abyssinian Ruby</td>
</tr>
<tr class="even">
<td align="left">Freedonia Copper</td>
</tr>
<tr class="odd">
<td align="left">Patagonian Tea</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="search-for-a-string-in-a-particular-position" class="section level3 unnumbered hasAnchor">
<h3>Search for a string in a particular position<a href="the-one-to-many-relationship.html#search-for-a-string-in-a-particular-position" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Sometimes you might be interested in identifying a string with a character in a particular position.</p>
<p><em>Find firms with ‘t’ as the third letter of their name.</em></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb49-1"><a href="the-one-to-many-relationship.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> stkfirm <span class="kw">FROM</span> stock <span class="kw">WHERE</span> stkfirm REGEXP <span class="st">&#39;^(.){2}t&#39;</span>;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-48">Table 4.11: </span>1 records</caption>
<thead>
<tr class="header">
<th align="left">stkfirm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Patagonian Tea</td>
</tr>
</tbody>
</table>
</div>
<p>The regular expression has three elements:</p>
<ul>
<li><p>^ indicates start searching at the beginning of the string;</p></li>
<li><p>(.){2} specifies that anything is acceptable for the next two characters;</p></li>
<li><p>t indicates what the next character, the third, must be.</p></li>
</ul>
</div>
<div id="search-for-a-string-not-containing-any-specified-characters" class="section level3 unnumbered hasAnchor">
<h3>Search for a string not containing any specified characters<a href="the-one-to-many-relationship.html#search-for-a-string-not-containing-any-specified-characters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There might be a need to find rows not containing specified characters anywhere in a givev coumn. You need to check every character in the string to ensure there are matches.</p>
<p><em>List the names of nations without s or S <strong>anywhere</strong> in their names</em></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb50-1"><a href="the-one-to-many-relationship.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> nation <span class="kw">WHERE</span> natname REGEXP <span class="st">&#39;^[^s|S]*$&#39;</span></span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-49">Table 4.12: </span>2 records</caption>
<thead>
<tr class="header">
<th align="left">natcode</th>
<th align="left">natname</th>
<th align="right">exchrate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">IND</td>
<td align="left">India</td>
<td align="right">0.0228</td>
</tr>
<tr class="even">
<td align="left">UK</td>
<td align="left">United Kingdom</td>
<td align="right">1.0000</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>^ start searching at the beginning of the string;</li>
<li>$ end searching at the end of the string;</li>
<li>* any character in a string;</li>
<li>^s|S no lower or upper case s.</li>
</ul>
<p>You have seen a few of the features of a very powerful tool. To learn more about regular expressions, see <a href="http://regexlib.com">regexlib.com</a>, which contains a library of regular expressions and a feature for finding expressions to solve specific problems. Check out the regular expression for checking whether a character string is a valid email address.</p>
</div>
</div>
<div id="subqueries-1" class="section level2 unnumbered hasAnchor">
<h2>Subqueries<a href="the-one-to-many-relationship.html#subqueries-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A subquery, or nested SELECT, is a SELECT nested within another SELECT. A subquery can be used to return a list of values subsequently searched with an IN clause.</p>
<p><em>Report the names of all Australian stocks.</em></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb51-1"><a href="the-one-to-many-relationship.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> stkfirm <span class="kw">FROM</span> stock</span>
<span id="cb51-2"><a href="the-one-to-many-relationship.html#cb51-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> natcode <span class="kw">IN</span></span>
<span id="cb51-3"><a href="the-one-to-many-relationship.html#cb51-3" aria-hidden="true" tabindex="-1"></a>        (<span class="kw">SELECT</span> natcode <span class="kw">FROM</span> nation</span>
<span id="cb51-4"><a href="the-one-to-many-relationship.html#cb51-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">WHERE</span> natname <span class="op">=</span> <span class="st">&#39;Australia&#39;</span>);</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-50">Table 4.13: </span>3 records</caption>
<thead>
<tr class="header">
<th align="left">stkfirm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Indooroopilly Ruby</td>
</tr>
<tr class="even">
<td align="left">Narembeen Emu</td>
</tr>
<tr class="odd">
<td align="left">Queensland Diamond</td>
</tr>
</tbody>
</table>
</div>
<p>Conceptually, the subquery is evaluated first. It returns a list of values for natcode (‘AUS’) so that the query then is the same as:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb52-1"><a href="the-one-to-many-relationship.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> stkfirm <span class="kw">FROM</span> stock</span>
<span id="cb52-2"><a href="the-one-to-many-relationship.html#cb52-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> natcode <span class="kw">IN</span> (<span class="st">&#39;AUS&#39;</span>);</span></code></pre></div>
<p>When discussing subqueries, sometimes a subquery is also called an <strong>inner query</strong>. The term <strong>outer query</strong> is applied to the SQL preceding the inner query. In this case, the outer and inner queries are:</p>
<table>
<colgroup>
<col width="21%" />
<col width="78%" />
</colgroup>
<tbody>
<tr class="odd">
<td>Outer query</td>
<td>SELECT stkfirm FROM stock WHERE natcode IN</td>
</tr>
<tr class="even">
<td>Inner query</td>
<td>(SELECT natcode FROM nation WHERE natname = ‘Australia’);</td>
</tr>
</tbody>
</table>
<p>Note that in this case we do not have to qualify <code>natcode</code>. There is no identity crisis, because <code>natcode</code> in the inner query is implicitly qualified as <code>nation.natcode</code> and <code>natcode</code> in the outer query is understood to be <code>stock.natcode</code>.</p>
<p>This query also can be run as a join by writing:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb53-1"><a href="the-one-to-many-relationship.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> stkfirm <span class="kw">FROM</span> stock <span class="kw">JOIN</span> nation</span>
<span id="cb53-2"><a href="the-one-to-many-relationship.html#cb53-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ON</span> stock.natcode <span class="op">=</span> nation.natcode</span>
<span id="cb53-3"><a href="the-one-to-many-relationship.html#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> natname <span class="op">=</span> <span class="st">&#39;Australia&#39;</span>;</span></code></pre></div>
<div id="correlated-subquery" class="section level4 unnumbered hasAnchor">
<h4>Correlated subquery<a href="the-one-to-many-relationship.html#correlated-subquery" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In a correlated subquery, the subquery cannot be evaluated independently of the outer query. It depends on the outer query for the values it needs to resolve the inner query. The subquery is evaluated for each value passed to it by the outer query. An example illustrates when you might use a correlated subquery and how it operates.</p>
<p><em>Find those stocks where the quantity is greater than the average for that country.</em></p>
<p>An approach to this query is to examine the rows of stock one a time, and each time compare the quantity of stock to the average for that country. This means that for each row, the subquery must receive the outer query’s country code so it can compute the average for that country.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb54-1"><a href="the-one-to-many-relationship.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> natname, stkfirm, stkqty <span class="kw">FROM</span> stock <span class="kw">JOIN</span> nation</span>
<span id="cb54-2"><a href="the-one-to-many-relationship.html#cb54-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ON</span> stock.natcode <span class="op">=</span> nation.natcode</span>
<span id="cb54-3"><a href="the-one-to-many-relationship.html#cb54-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> stkqty <span class="op">&gt;</span></span>
<span id="cb54-4"><a href="the-one-to-many-relationship.html#cb54-4" aria-hidden="true" tabindex="-1"></a>        (<span class="kw">SELECT</span> <span class="fu">avg</span>(stkqty) <span class="kw">FROM</span> stock</span>
<span id="cb54-5"><a href="the-one-to-many-relationship.html#cb54-5" aria-hidden="true" tabindex="-1"></a>            <span class="kw">WHERE</span> stock.natcode <span class="op">=</span> nation.natcode);</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-53">Table 4.14: </span>4 records</caption>
<thead>
<tr class="header">
<th align="left">natname</th>
<th align="left">stkfirm</th>
<th align="right">stkqty</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Australia</td>
<td align="left">Queensland Diamond</td>
<td align="right">89251</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="left">Bolivian Sheep</td>
<td align="right">231678</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="left">Royal Ostrich Farms</td>
<td align="right">1234923</td>
</tr>
<tr class="even">
<td align="left">United States</td>
<td align="left">Minnesota Gold</td>
<td align="right">816122</td>
</tr>
</tbody>
</table>
</div>
<p>Conceptually, think of this query as stepping through the join of <code>stock</code> and <code>nation</code> one row at a time and executing the subquery each time. The first row has <code>natcode</code> = ‘AUS’ so the subquery becomes</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb55-1"><a href="the-one-to-many-relationship.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">AVG</span>(stkqty) <span class="kw">FROM</span> stock</span>
<span id="cb55-2"><a href="the-one-to-many-relationship.html#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> stock.natcode <span class="op">=</span> <span class="st">&#39;AUS&#39;</span>;</span></code></pre></div>
<p>Since the average stock quantity for Australian stocks is 63,672.33, the first row in the join, Narembeen Emu, is not reported. Neither is the second row reported, but the third is.</p>
<p>The term <strong>correlated subquery</strong> is used because the inner query’s execution depends on receiving a value for a variable (<code>nation.natcode</code> in this instance) from the outer query. Thus, the inner query of the correlated subquery cannot be evaluated once and for all. It must be evaluated repeatedly—once for each value of the variable received from the outer query. In this respect, a correlated subquery is different from a subquery, where the inner query needs to be evaluated only once. The requirement to compare each row of a table against a function (e.g., average or count) for some rows of a column is usually a clue that you need to write a correlated subquery.</p>
<blockquote>
<p>❓ <em>Skill builder</em></p>
<p>Why are no Indian stocks reported in the correlated subquery example? How would you change the query to report an Indian stock?
Report only the three stocks with the largest quantities (i.e., do the query without using ORDER BY).</p>
</blockquote>
</div>
<div id="viewsvirtual-tables" class="section level3 unnumbered hasAnchor">
<h3>Views—virtual tables<a href="the-one-to-many-relationship.html#viewsvirtual-tables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You might have noticed that in these examples we repeated the join and stock value calculation for each query. Ideally, we should do this once, store the result, and be able to use it with other queries. We can do so if we create a <strong><em>view</em></strong>, a virtual table. A view does not physically exist as stored data; it is an imaginary table constructed from existing tables as required. You can treat a view as if it were a table and write SQL to query it.</p>
<p>A view contains selected columns from one or more tables. The selected columns can be renamed and rearranged. New columns based on arithmetic expressions can be created. GROUP BY can also be used when creating a view. Remember, a view contains no actual data. It is a virtual table.</p>
<p>This SQL command does the join, calculates stock value, and saves the result as a view:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb56-1"><a href="the-one-to-many-relationship.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">VIEW</span> stkvalue</span>
<span id="cb56-2"><a href="the-one-to-many-relationship.html#cb56-2" aria-hidden="true" tabindex="-1"></a>    (nation, firm, price, qty, exchrate, <span class="fu">value</span>)</span>
<span id="cb56-3"><a href="the-one-to-many-relationship.html#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AS</span> <span class="kw">SELECT</span> natname, stkfirm, stkprice, stkqty, exchrate,</span>
<span id="cb56-4"><a href="the-one-to-many-relationship.html#cb56-4" aria-hidden="true" tabindex="-1"></a>        stkprice<span class="op">*</span>stkqty<span class="op">*</span>exchrate</span>
<span id="cb56-5"><a href="the-one-to-many-relationship.html#cb56-5" aria-hidden="true" tabindex="-1"></a>            <span class="kw">FROM</span> stock <span class="kw">JOIN</span> nation</span>
<span id="cb56-6"><a href="the-one-to-many-relationship.html#cb56-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">ON</span> stock.natcode <span class="op">=</span> nation.natcode;</span></code></pre></div>
<p>There are several things to notice about creating a view:</p>
<ul>
<li>The six names enclosed in parentheses are the column names for the view.</li>
<li>There is a one-to-one correspondence between the names in parentheses and the names or expressions in the SELECT clause. Thus the view column named <code>value</code> contains the result of the arithmetic expression <code>stkprice * stkqty * exchrate</code>.</li>
</ul>
<p>A view can be used in a query, such as:</p>
<p><em>Find stocks with a value greater than £100,000.</em></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb57-1"><a href="the-one-to-many-relationship.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> nation, firm, <span class="fu">value</span> <span class="kw">FROM</span> stkvalue <span class="kw">WHERE</span> <span class="fu">value</span> <span class="op">&gt;</span> <span class="dv">100000</span>;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:view">Table 4.15: </span>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th align="left">nation</th>
<th align="left">firm</th>
<th align="right">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Australia</td>
<td align="left">Indooroopilly Ruby</td>
<td align="right">411175.7</td>
</tr>
<tr class="even">
<td align="left">Australia</td>
<td align="left">Narembeen Emu</td>
<td align="right">258951.7</td>
</tr>
<tr class="odd">
<td align="left">Australia</td>
<td align="left">Queensland Diamond</td>
<td align="right">276303.2</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="left">Abyssinian Ruby</td>
<td align="right">700358.2</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="left">Bolivian Sheep</td>
<td align="right">2953894.5</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="left">Canadian Sugar</td>
<td align="right">248910.5</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="left">Indian Lead &amp; Zinc</td>
<td align="right">241222.5</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="left">Nigerian Geese</td>
<td align="right">431305.0</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="left">Patagonian Tea</td>
<td align="right">698083.8</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="left">Royal Ostrich Farms</td>
<td align="right">41678651.2</td>
</tr>
</tbody>
</table>
</div>
<p>There are two main reasons for creating a view. <em>First<strong>,</strong></em> as we have seen, query writing can be simplified. If you find that you are frequently writing the same section of code for a variety of queries, then isolate the common section and put it in a view. This means that you will usually create a view when a fact, such as stock value, is derived from other facts in the table.</p>
<p>The <em>second</em> reason is to restrict access to certain columns or rows. For example, the person who updates <code>stock</code> could be given a view that excludes <code>stkqty</code>. In this case, changes in stock prices could be updated without revealing confidential information, such as the value of the stock portfolio.</p>
<blockquote>
<p>❓ <em>Skill builder</em></p>
<p>How could you use a view to solve the following query that was used when discussing the correlated subquery?</p>
<p><em>Find those stocks where the quantity is greater than the average for that country.</em></p>
</blockquote>
</div>
<div id="summary-3" class="section level3 unnumbered hasAnchor">
<h3>Summary<a href="the-one-to-many-relationship.html#summary-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Entities are related to other entities by relationships. The 1:m (one-to-many) relationship occurs frequently in data models. An additional entity is required to represent a 1:m relationship to avoid update anomalies. In a relational database, a 1:m relationship is represented by an additional column, the foreign key, in the table at the many end of the relationship. The referential integrity constraint insists that a foreign key must always exist as a primary key in a table. A foreign key constraint is specified in a CREATE statement.</p>
<p>Join creates a new table from two existing tables by matching on a column common to both tables. Often the common column is a primary key–foreign key combination. A theta-join can have matching conditions of =, &lt;&gt;, &lt;=, &lt;, &gt;=, and &gt;. An equijoin describes the situation where the matching condition is equality. The GROUP BY clause is used to create an elementary control break report. The HAVING clause of GROUP BY is like the WHERE clause of SELECT. A subquery, which has a SELECT statement within another SELECT statement, causes two SELECT statements to be executed—one for the inner query and one for the outer query. A correlated subquery is executed as many times as there are rows selected by the outer query. A view is a virtual table that is created when required. Views can simplify report writing and restrict access to specified columns or rows.</p>
</div>
<div id="key-terms-and-concepts-1" class="section level3 unnumbered hasAnchor">
<h3>Key terms and concepts<a href="the-one-to-many-relationship.html#key-terms-and-concepts-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<table>
<tbody>
<tr class="odd">
<td align="left">Constraint</td>
<td align="left">JOIN</td>
</tr>
<tr class="even">
<td align="left">Control break reporting</td>
<td align="left">One-to-many (1:m) relationship</td>
</tr>
<tr class="odd">
<td align="left">Correlated subquery</td>
<td align="left">Referential integrity</td>
</tr>
<tr class="even">
<td align="left">Delete anomalies</td>
<td align="left">Relationship</td>
</tr>
<tr class="odd">
<td align="left">Equijoin</td>
<td align="left">Theta-join</td>
</tr>
<tr class="even">
<td align="left">Foreign key</td>
<td align="left">Update anomalies</td>
</tr>
<tr class="odd">
<td align="left">GROUP BY</td>
<td align="left">Views</td>
</tr>
<tr class="even">
<td align="left">HAVING</td>
<td align="left">Virtual table</td>
</tr>
<tr class="odd">
<td align="left">Insert anomalies</td>
<td align="left"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="exercises-3" class="section level2 unnumbered hasAnchor">
<h2>Exercises<a href="the-one-to-many-relationship.html#exercises-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><p>Draw data models for the following situations. In each case, make certain that you show the attributes and feasible identifiers:</p>
<ol style="list-style-type: lower-alpha">
<li><p>A farmer can have many cows, but a cow belongs to only one farmer.</p></li>
<li><p>A university has many students, and a student can attend at most one university.</p></li>
<li><p>An aircraft can have many passengers, but a passenger can be on only one flight at a time.</p></li>
<li><p>A nation can have many states and a state many cities.</p></li>
<li><p>An art researcher has asked you to design a database to record details of artists and the museums in which their paintings are displayed. For each painting, the researcher wants to know the size of the canvas, year painted, title, and style. The nationality, date of birth, and death of each artist must be recorded. For each museum, record details of its location and specialty, if it has one.</p></li>
</ol></li>
<li><p>Report all values in British pounds:</p>
<ol style="list-style-type: lower-alpha">
<li><p>Report the value of stocks listed in Australia.</p></li>
<li><p>Report the dividend payment of all stocks.</p></li>
<li><p>Report the total dividend payment by nation.</p></li>
<li><p>Create a view containing nation, firm, price, quantity, exchange rate, value, and yield.</p></li>
<li><p>Report the average yield by nation.</p></li>
<li><p>Report the minimum and maximum yield for each nation.</p></li>
<li><p>Report the nations where the average yield of stocks exceeds the average yield of all stocks.</p></li>
</ol></li>
<li><p>How would you change the queries in exercise 4-2 if you were required to report the values in American dollars, Australian dollars, or Indian rupees?</p></li>
<li><p>What is a foreign key and what role does it serve?</p></li>
<li><p>What is the referential integrity constraint? Why should it be enforced?</p></li>
<li><p>Kisha, against the advice of her friends, is simultaneously studying data management and Shakespearean drama. She thought the two subjects would be an interesting contrast. However, the classes are very demanding and often enter her midsummer dreams. Last night, she dreamed that William Shakespeare wanted her to draw a data model. He explained, before she woke up in a cold sweat, that a play had many characters but the same character never appeared in more than one play. “Methinks,” he said, “the same name may have appeareth more than the once, but ’twas always a person of a different ilk.” He then, she hazily recollects, went on to spout about the quality of data dropping like the gentle rain. Draw a data model to keep old Bill quiet and help Kisha get some sleep.</p></li>
<li><p>An orchestra has four broad classes of instruments (strings, woodwinds, brass, and percussion). Each class contains musicians who play different instruments. For example, the strings section of a full symphony orchestra contains 2 harps, 16 to 18 first violins, 14 to 16 second violins, 12 violas, 10 cellos, and 8 double basses. A city has asked you to develop a database to store details of the musicians in its three orchestras. All the musicians are specialists and play only one instrument for one orchestra.</p></li>
</ol>
<p><img src="Figures/Chapter%204/person-car.png" width="335" /></p>
<ol start="8" style="list-style-type: decimal">
<li><p>Answer the following queries based on the following database for a car dealer:</p>
<ol style="list-style-type: lower-alpha">
<li><p>What is the personid of Sheila O’Hara?</p></li>
<li><p>List sales personnel sorted by last name and within last name, first name.</p></li>
<li><p>List details of the sales made by Bruce Bush.</p></li>
<li><p>List details of all sales showing the gross profit (selling price minus cost price).</p></li>
<li><p>Report the number of cars sold of each type.</p></li>
<li><p>What is the average selling price of cars sold by Sue Lim?</p></li>
<li><p>Report details of all sales where the gross profit is less than the average.</p></li>
<li><p>What was the maximum selling price of any car?</p></li>
<li><p>What is the total gross profit?</p></li>
<li><p>Report the gross profit made by each salesperson who sold at least three cars.</p></li>
<li><p>Create a view containing all the details in the car table and the gross profit</p></li>
</ol></li>
<li><p>Find stocks where the third or fourth letter in their name is an ‘m’.</p></li>
<li><p>An electricity supply company needs a database to record details of solar panels installed on its customers’ homes so it can estimate how much solar energy will be generated based on the forecast level of solar radiation for each house’s location. A solar panel has an area, measured in square meters, and an efficiency expressed as a percentage (e.g., 22% efficiency means that 22% of the incident solar energy is converted into electrical energy). Create a data model. How will you identify each customer and each panel?</p></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-single-entity.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="the-many-to-many-relationship.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["DataManagement.pdf", "DataManagement.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
